<% last_depth = -1 %>
<% pages = @pages.entries %>
<% pages.each_with_index do |page, i| %>
  <% diff = page.depth - last_depth %>
  <% if diff > 0 %>
    <% new_branch = true %>
    <% diff.times do %>
      <ul class="<%= 'trunk' if i == 0 %>" >
    <% end %>
  <% else %>
    </li>
    <% if diff < 0 %>
      <% (diff*-1).times do %>
        </ul></li>
      <% end %>
    <% end %>
  <% end %>
    <li id="page_<%= page.id %>">
      <div>
        <%= page.title %>(<%= page.leaf? %>)
        <% if page.draft %> <em>(draft)</em><% end %>
        <% unless page.show_in_menu %> <em>(hidden)</em><% end %>
        <span class="actions">
          <%= link_to "Show", page_friendly_path(page.path) %> | 
          <%= link_to "Settings", edit_page_path(page.id) %> | 
          <%= link_to "Layout", page_layouts_path(page.id) %> | 
          <%= link_to "Content", page_blocks_path(page.id) %> | 
          <%= link_to 'Delete', page, :confirm => 'Are you sure?', :method => :delete, :remote => true %>
        </span>
      </div>
  <% last_depth = page.depth %>
<% end %>

