= simple_form_for [:admin, @event] do |f|
  .panel.panel-default
    .panel-heading Logistics
    .panel-body
      - if params[:action] == 'new'
        .row
          .col-sm-6
            = f.input :season_id, :as => :select, :collection => @season_options
          .col-sm-6
            = f.input :league_id, :as => :select, :collection => @league_options
      .row
        .col-sm-4
          = f.input :starts_on, :as => :string, :input_html => { :value => @event.starts_on ? I18n.l(@event.starts_on) : "" }
        .col-sm-2
          = f.input :duration
      = f.input :all_day, :as => :boolean, :wrapper => :vertical_boolean
      .row
        .col-sm-4
          = f.input :location_id, :as => :select, :collection => @location_options

  .panel.panel-default
    .panel-heading Display
    .panel-body
      = f.input :summary
      =f.input :description, :as => :text

  = f.button :wrapped, :cancel => return_url

- content_for :javascript do
  :javascript
    $(document).ready(function(){
        $("select#event_season_id").change(function(){
            var id_value_string = $(this).val();
            if (id_value_string == "") {
                // if the id is empty remove all the sub_selection options from being selectable and do not do any ajax
                $("select[id$='league_id'] option").remove();
                var row = "<option value=\"" + "" + "\">" + "" + "</option>";
                $(row).appendTo("select[id$='league_id']");
            }
            else {
              $.ajax({
                  dataType: "json",
                  cache: false,
                  url: '#{admin_leagues_path}?season_id=' + id_value_string,
                  timeout: 2000,
                  error: function(XMLHttpRequest, errorTextStatus, error){
                      alert("Failed to submit : "+ errorTextStatus+" ;"+error);
                  },
                  success: function(data){
                      $("select[id$='league_id'] option").remove();
                      var row = "<option value=\"" + "" + "\">" + "" + "</option>";
                      $(row).appendTo("select[id$='league_id']");
                      $.each(data, function(i, j){
                          row = "<option value=\"" + j._id + "\">" + j.name + "</option>";
                          $(row).appendTo("select[id$='league_id']");
                      });
                   }
              });
            };
        });
    });


