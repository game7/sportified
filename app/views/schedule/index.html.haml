- title "Schedule"
- last_date = nil

- if current_user_is_admin?
  - content_for :actions do
    .btn-group
      %button.btn.btn-primary.dropdown-toggle(data-toggle="dropdown")
        = icon('plus')
      %ul.dropdown-menu.dropdown-menu-right
        %li= link_to "New Event", new_admin_league_event_path(:season_id => @season, :division_id => @division)
        %li= link_to "New Game", new_admin_league_game_path(:season_id => @season, :division_id => @division)

.row.options
  .col-sm-8
    = render :partial => "shared/select_date_range", :locals => { :start_date => @start_date, :end_date => @end_date, :prev_date => @prev_date, :next_date => @next_date, :range => @days_in_future + @days_in_past }
  .col-sm-4
    = select("team", :id, @team_options, {}, { :class => "redirect_to form-control", :style => "margin: 0px 0 0 0;" }) if @division

%table.table.table-striped.table-bordered
  - events = @events.entries
  - if events.count == 0
    %tr
      %td No events scheduled
  - else
    - events.each do |event|
      - if event.starts_on.to_date != last_date
        - reset_cycle()
        %tr.group-head
          %th{ :colspan => "3" }
            = event.starts_on.to_date.strftime("%A, %B %e %Y")
      %tr
        %td
          .visible-xs= event.starts_on.strftime("%l:%M%P").gsub("m","")
          .hidden-xs= event.starts_on.strftime("%l:%M %P")
        %td
          = event.summary
          - if current_user_is_admin?
            .pull-right
              = link_to "Edit", edit_polymorphic_path([:admin, event.module_name, event]), :class => 'btn btn-primary btn-xs'
              = link_to "Clone", new_polymorphic_path([:admin, event.module_name, event.class], :clone => event.id), :class => 'btn btn-primary btn-xs'
        %td
          - if event.location
            .visible-xs= event.location.short_name
            .hidden-xs= event.location.name
      - last_date = event.starts_on.to_date
- if events.count > 4
  .row
    .col-sm-8
      = render :partial => "shared/select_date_range", :locals => { :start_date => @start_date, :end_date => @end_date, :prev_date => @prev_date, :next_date => @next_date, :range => @days_in_future + @days_in_past }
